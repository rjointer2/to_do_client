
// next
import Head from 'next/head';
import { useRouter } from 'next/router';

// components
import Navbar from '../client_modules/components/Navbar/Navbar';
import NavDropDown from '../client_modules/components/DropDowns/NavDropDown/NavDropDown';

// react
import { useEffect, useRef, useState } from 'react';


// apollo
import { TODOS } from '../client_modules/apollo_client/querys/todos';
import { useGlobalState } from '../client_modules/hooks/useGlobalStateHook';
import { useQuery } from '@apollo/client';
import { ME } from '../client_modules/apollo_client/querys/user'
import { AppLayout, AppLayOutItems } from '../client_modules/styled_components/aligment';
import Settings from '../client_modules/components/Settings/Settings';
import ActionButton from '../client_modules/components/ActionButton/ActionButton';
import TodoDropDown from '../client_modules/components/DropDowns/TodoDropDown/TodoDropDown';
import client from '../client_modules/apollo_client/configs/client';





export default function Home() {

  const { state, dispatch } = useGlobalState();
  const { menu, user } = state




  let offset = 0
  let limit = 10


  const { data, loading, error } = useQuery(ME)


  useEffect(() => {
    if(data) {
      dispatch({ type: "USER_LOGGED_IN", payload: data.me })
    } else {
      dispatch({ type: "USER_LOGGED_OUT", payload: null })
    }
    

  }, [data])


  return (
    <>
      <Head>
        <title>To Do App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <NavDropDown />
      <TodoDropDown />
      <Navbar />


      <AppLayout>
        <AppLayOutItems>
          <Settings/>
        </AppLayOutItems>
        <AppLayOutItems>
          { user?.data && <ActionButton /> }
          Hi World { user?.data && user?.data.username }
        </AppLayOutItems>
      </AppLayout>
      
      
    </>
  )
}
